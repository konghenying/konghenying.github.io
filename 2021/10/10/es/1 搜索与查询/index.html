
<!DOCTYPE html>
<html lang="zh-CN" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>搜索与查询 - 空痕影的从头再来</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="TriDiamond Obsidian,"> 
    <meta name="description" content="搜索与查询查询上下文查询示例GET kibana_sample_data_ecommerce/_search
&amp;#123;
  &amp;quot;size&amp;quot;: 1
&amp;#125;


&amp;#123;,"> 
    <meta name="author" content="空痕影"> 
    <link rel="alternative" href="atom.xml" title="空痕影的从头再来" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    
<link rel="stylesheet" href="//at.alicdn.com/t/font_1429596_nzgqgvnmkjb.css">

    
<link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.7.2/animate.min.css">

    
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">

    
<link rel="stylesheet" href="//cdn.bootcss.com/codemirror/5.48.4/codemirror.min.css">

    
<link rel="stylesheet" href="//cdn.bootcss.com/codemirror/5.48.4/theme/dracula.css">

    
<link rel="stylesheet" href="/css/obsidian.css">

    
<link rel="stylesheet" href="/css/ball-atom.min.css">

    
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="loading">
    <div class="loader">
        <div class="la-ball-atom la-2x">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
    <span id="config-title" style="display:none">空痕影的从头再来</span>
    <div id="loader"></div>
    <div id="single">
    <div class="scrollbar gradient-bg-rev"></div>
<div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <div class="navigation animated fadeIn fast delay-1s">
        <img id="home-icon" class="icon-home" src="/img/favicon.png" alt="" data-url="https://konghenying.github.io">
        <div id="play-icon" title="Play/Pause" class="iconfont icon-play"></div>
        <h3 class="subtitle">搜索与查询</h3>
        <div class="social">
            <!--        <div class="like-icon">-->
            <!--            <a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
            <!--        </div>-->
            <div>
                <div class="share">
                    
                        <a href="javascript:;" class="iconfont icon-share1"></a>
                        <div class="share-component-cc" data-disabled="facebook,douban,linkedin,diandian,tencent,google"></div>
                    
                </div>
            </div>
        </div>
    </div>
</div>

    <div class="section">
        <div class=article-header-wrapper>
    <div class="article-header">
        <div class="article-cover animated fadeIn" style="
            animation-delay: 600ms;
            animation-duration: 1.2s;
            background-image: 
                radial-gradient(ellipse closest-side, rgba(0, 0, 0, 0.65), #100e17),
                url(/img/cover.jpg) ">
        </div>
        <div class="else">
            <p class="animated fadeInDown">
                
                <a href="/categories/es"><b>「
                    </b>ES<b> 」</b></a>
                
                十月 10, 2021
            </p>
            <h3 class="post-title animated fadeInDown"><a href="/2021/10/10/es/1%20%E6%90%9C%E7%B4%A2%E4%B8%8E%E6%9F%A5%E8%AF%A2/" title="搜索与查询" class="">搜索与查询</a>
            </h3>
            
            <p class="post-count animated fadeInDown">
                
                <span>
                    <b class="iconfont icon-text2"></b> <i>文章字数</i>
                    20k
                </span>
                
                
                <span>
                    <b class="iconfont icon-timer__s"></b> <i>阅读约需</i>
                    18 mins.
                </span>
                
                
                
                <span id="busuanzi_container_page_pv">
                    <b class="iconfont icon-read"></b> <i>阅读次数</i>
                    <span id="busuanzi_value_page_pv">0</span>
                </span>
                
            </p>
            
            
            <ul class="animated fadeInDown post-tags-list" itemprop="keywords"><li class="animated fadeInDown post-tags-list-item"><a class="animated fadeInDown post-tags-list-link" href="/tags/es/" rel="tag">es</a></li></ul>
            
        </div>
    </div>
</div>

<div class="screen-gradient-after">
    <div class="screen-gradient-content">
        <div class="screen-gradient-content-inside">
            <div class="bold-underline-links screen-gradient-sponsor">
                <p>
                    <span class="animated fadeIn delay-1s"></span>
                </p>
            </div>
        </div>
    </div>
</div>

<div class="article">
    <div class='main'>
        <div class="content markdown animated fadeIn">
            <h1 id="搜索与查询"><a href="#搜索与查询" class="headerlink" title="搜索与查询"></a>搜索与查询</h1><h2 id="查询上下文"><a href="#查询上下文" class="headerlink" title="查询上下文"></a>查询上下文</h2><h3 id="查询示例"><a href="#查询示例" class="headerlink" title="查询示例"></a>查询示例</h3><pre><code class="json">GET kibana_sample_data_ecommerce/_search
&#123;
  &quot;size&quot;: 1
&#125;


&#123;
  &quot;took&quot; : 0,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : &#123;
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  &#125;,
  &quot;hits&quot; : &#123;
    &quot;total&quot; : &#123;
      &quot;value&quot; : 4675,
      &quot;relation&quot; : &quot;eq&quot;
    &#125;,
    &quot;max_score&quot; : 1.0,
    &quot;hits&quot; : [
      &#123;
        &quot;_index&quot; : &quot;kibana_sample_data_ecommerce&quot;,
        &quot;_type&quot; : &quot;_doc&quot;,
        &quot;_id&quot; : &quot;VB2OXXwBYKHeDs_3_B9c&quot;,
        &quot;_score&quot; : 1.0,
        &quot;_source&quot; : &#123;
          &quot;category&quot; : [
            &quot;Men&#39;s Clothing&quot;
          ],
          &quot;currency&quot; : &quot;EUR&quot;,
          &quot;customer_first_name&quot; : &quot;Eddie&quot;,
          &quot;customer_full_name&quot; : &quot;Eddie Underwood&quot;,
          &quot;customer_gender&quot; : &quot;MALE&quot;,
          &quot;customer_id&quot; : 38,
          &quot;customer_last_name&quot; : &quot;Underwood&quot;,
          &quot;customer_phone&quot; : &quot;&quot;,
          &quot;day_of_week&quot; : &quot;Monday&quot;,
          &quot;day_of_week_i&quot; : 0,
          &quot;email&quot; : &quot;eddie@underwood-family.zzz&quot;,
          &quot;manufacturer&quot; : [
            &quot;Elitelligence&quot;,
            &quot;Oceanavigations&quot;
          ],
          &quot;order_date&quot; : &quot;2021-10-18T09:28:48+00:00&quot;,
          &quot;order_id&quot; : 584677,
          &quot;products&quot; : [
            &#123;
              &quot;base_price&quot; : 11.99,
              &quot;discount_percentage&quot; : 0,
              &quot;quantity&quot; : 1,
              &quot;manufacturer&quot; : &quot;Elitelligence&quot;,
              &quot;tax_amount&quot; : 0,
              &quot;product_id&quot; : 6283,
              &quot;category&quot; : &quot;Men&#39;s Clothing&quot;,
              &quot;sku&quot; : &quot;ZO0549605496&quot;,
              &quot;taxless_price&quot; : 11.99,
              &quot;unit_discount_amount&quot; : 0,
              &quot;min_price&quot; : 6.35,
              &quot;_id&quot; : &quot;sold_product_584677_6283&quot;,
              &quot;discount_amount&quot; : 0,
              &quot;created_on&quot; : &quot;2016-12-26T09:28:48+00:00&quot;,
              &quot;product_name&quot; : &quot;Basic T-shirt - dark blue/white&quot;,
              &quot;price&quot; : 11.99,
              &quot;taxful_price&quot; : 11.99,
              &quot;base_unit_price&quot; : 11.99
            &#125;,
            &#123;
              &quot;base_price&quot; : 24.99,
              &quot;discount_percentage&quot; : 0,
              &quot;quantity&quot; : 1,
              &quot;manufacturer&quot; : &quot;Oceanavigations&quot;,
              &quot;tax_amount&quot; : 0,
              &quot;product_id&quot; : 19400,
              &quot;category&quot; : &quot;Men&#39;s Clothing&quot;,
              &quot;sku&quot; : &quot;ZO0299602996&quot;,
              &quot;taxless_price&quot; : 24.99,
              &quot;unit_discount_amount&quot; : 0,
              &quot;min_price&quot; : 11.75,
              &quot;_id&quot; : &quot;sold_product_584677_19400&quot;,
              &quot;discount_amount&quot; : 0,
              &quot;created_on&quot; : &quot;2016-12-26T09:28:48+00:00&quot;,
              &quot;product_name&quot; : &quot;Sweatshirt - grey multicolor&quot;,
              &quot;price&quot; : 24.99,
              &quot;taxful_price&quot; : 24.99,
              &quot;base_unit_price&quot; : 24.99
            &#125;
          ],
          &quot;sku&quot; : [
            &quot;ZO0549605496&quot;,
            &quot;ZO0299602996&quot;
          ],
          &quot;taxful_total_price&quot; : 36.98,
          &quot;taxless_total_price&quot; : 36.98,
          &quot;total_quantity&quot; : 2,
          &quot;total_unique_products&quot; : 2,
          &quot;type&quot; : &quot;order&quot;,
          &quot;user&quot; : &quot;eddie&quot;,
          &quot;geoip&quot; : &#123;
            &quot;country_iso_code&quot; : &quot;EG&quot;,
            &quot;location&quot; : &#123;
              &quot;lon&quot; : 31.3,
              &quot;lat&quot; : 30.1
            &#125;,
            &quot;region_name&quot; : &quot;Cairo Governorate&quot;,
            &quot;continent_name&quot; : &quot;Africa&quot;,
            &quot;city_name&quot; : &quot;Cairo&quot;
          &#125;
        &#125;
      &#125;
    ]
  &#125;
&#125;
</code></pre>
<h3 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h3><pre><code class="json">&#123;
  &quot;took&quot; : 0,                  -- 请求消耗的时间
  &quot;timed_out&quot; : false,      -- 当前请求是否超时
  &quot;_shards&quot; : &#123;             -- 当前请求的分片
    &quot;total&quot; : 1,                -- 一共一个
    &quot;successful&quot; : 1,            -- 成功一个
    &quot;skipped&quot; : 0,                -- 跳过0个
    &quot;failed&quot; : 0                -- 失败0个
  &#125;,
  &quot;hits&quot; : &#123;                -- 请求结果
    &quot;total&quot; : &#123;                -- 请求统计
      &quot;value&quot; : 4675,            -- 请求查询到4675条记录
      &quot;relation&quot; : &quot;eq&quot;          -- 当前查询关系 等于
    &#125;,
    &quot;max_score&quot; : 1.0,        -- 当前返回结果最大评分为1.0
    &quot;hits&quot; : [                -- 请求结果数据
      &#123;
        &quot;_index&quot; : &quot;kibana_sample_data_ecommerce&quot;,    -- 当前数据所在索引
        &quot;_type&quot; : &quot;_doc&quot;,                -- 数据类型,7.0之前可以自定义,之后固定为_doc
        &quot;_id&quot; : &quot;VB2OXXwBYKHeDs_3_B9c&quot;,  -- 当前数据id
        &quot;_score&quot; : 1.0,                    -- 相关度评分1.0. 默认根据评分排序,由高到低
        &quot;_source&quot; : &#123;                    -- 导入的数据
          &quot;customer_full_name&quot; : &quot;Eddie Underwood&quot;,
          &quot;customer_gender&quot; : &quot;MALE&quot;,
          &quot;customer_id&quot; : 38,
          &quot;customer_last_name&quot; : &quot;Underwood&quot;
        &#125;
      &#125;
    ]
  &#125;
&#125;
</code></pre>
<h2 id="相关度评分"><a href="#相关度评分" class="headerlink" title="相关度评分"></a>相关度评分</h2><p>数据根据查询的条件,算出一个相关度评分,然后数据根据相关度评分从高到低排序列出,在没有排序条件的时候.</p>
<p>在7.x之前相关度评分默认使用TF/IDF算法计算而来，7.x之后默认为BM25。</p>
<h2 id="元数据"><a href="#元数据" class="headerlink" title="元数据"></a>元数据</h2><ol>
<li><p>禁用元数据<br>好处: 节约开销,节省不必要的查询浪费.</p>
<p>坏处:</p>
<ul>
<li>不支持update、update_by_query和reindex API。</li>
<li>不支持高亮.</li>
<li>不支持reindex,更改mapping分析器与版本升级.</li>
<li>通过查看索引时使用的原始文档来调试查询或聚合的功能。</li>
<li>将来有可能自动修复索引损坏。</li>
</ul>
<p>总结: 可以使用压缩索引的方式来节省磁盘,比直接禁用更好.</p>
<pre><code class="json">GET kibana_sample_data_ecommerce/_search
&#123;
  &quot;_source&quot;: &quot;fasle&quot;   -- 查询时添加 -souce: false 条件
  , &quot;size&quot;: 1
&#125;
结果:
&#123;
  &quot;took&quot; : 1,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : &#123;
    &quot;total&quot; : 6,
    &quot;successful&quot; : 6,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  &#125;,
  &quot;hits&quot; : &#123;
    &quot;total&quot; : &#123;
      &quot;value&quot; : 4744,
      &quot;relation&quot; : &quot;eq&quot;
    &#125;,
    &quot;max_score&quot; : 1.0,
    &quot;hits&quot; : [
      &#123;
        &quot;_index&quot; : &quot;.kibana-event-log-7.8.0-000001&quot;,
        &quot;_type&quot; : &quot;_doc&quot;,
        &quot;_id&quot; : &quot;Ih2OXXwBYKHeDs_3uR8r&quot;,
        &quot;_score&quot; : 1.0,
        &quot;_source&quot; : &#123; &#125;         -- _souce元数据不输出.
      &#125;
    ]
  &#125;
&#125;
</code></pre>
</li>
<li><p>数据源过滤器</p>
<p>including: 结果中返回哪些字段</p>
<p>Excluding: 结果中不返回哪些字段.只是结果字段不返回,还是可以通过字段进行检索.</p>
<p>使用:</p>
<ol>
<li><p>在mapping中定义过滤：支持通配符，但是这种方式不推荐，因为mapping不可变</p>
<pre><code class="json">PUT user  -- 设置用户索引mappings
&#123;
  &quot;mappings&quot;: &#123;
    &quot;_source&quot;: &#123;
      &quot;includes&quot;: [
          &quot;name&quot;,
          &quot;age&quot;
        ],
        &quot;excludes&quot;: [
          &quot;sex&quot;,
          &quot;birth&quot;
          ]
    &#125;
  &#125;
&#125;

PUT user/_doc/1 -- 插入一条数据
&#123;
  &quot;name&quot;: &quot;空痕影&quot;,
  &quot;age&quot;: 18,
  &quot;birth&quot;: &quot;2000-12-12&quot;,
  &quot;sex&quot;: &quot;男&quot;
&#125;

GET user/_search  -- 查询
结果:

&#123;
  &quot;took&quot; : 880,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : &#123;
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  &#125;,
  &quot;hits&quot; : &#123;
    &quot;total&quot; : &#123;
      &quot;value&quot; : 1,
      &quot;relation&quot; : &quot;eq&quot;
    &#125;,
    &quot;max_score&quot; : 1.0,
    &quot;hits&quot; : [
      &#123;
        &quot;_index&quot; : &quot;user&quot;,
        &quot;_type&quot; : &quot;_doc&quot;,
        &quot;_id&quot; : &quot;1&quot;,
        &quot;_score&quot; : 1.0,
        &quot;_source&quot; : &#123;    -- 只显示name与age,不显示birth与sex
          &quot;name&quot; : &quot;空痕影&quot;,
          &quot;age&quot; : 18
        &#125;
      &#125;
    ]
  &#125;
&#125;
</code></pre>
</li>
<li><p>查询的时候动态的指定source</p>
<ul>
<li><p>“_source” : “false”,</p>
</li>
<li><p>“_source” : “obj.*”,</p>
</li>
<li><p>“_source” : [“obj1.<em>“,”obj2.</em>“],</p>
</li>
<li><p>“_source” : {</p>
<p>​    “includes”:[“obj1.<em>“,”obj2.</em>“],</p>
<p>​    “excludes”:[“*.obj3”]</p>
<p>}</p>
<p>注:如果有includes与excludes有交集,以excludes为准,即不显示交集字段.</p>
</li>
</ul>
<pre><code class="json">
GET user/_search
&#123;
  &quot;_source&quot;: &#123;
    &quot;includes&quot;: [&quot;name&quot;,&quot;age&quot;,&quot;birth&quot;],
    &quot;excludes&quot;: [&quot;age&quot;]
  &#125;
&#125;
结果:
&#123;
  &quot;took&quot; : 0,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : &#123;
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  &#125;,
  &quot;hits&quot; : &#123;
    &quot;total&quot; : &#123;
      &quot;value&quot; : 1,
      &quot;relation&quot; : &quot;eq&quot;
    &#125;,
    &quot;max_score&quot; : 1.0,
    &quot;hits&quot; : [
      &#123;
        &quot;_index&quot; : &quot;user&quot;,
        &quot;_type&quot; : &quot;_doc&quot;,
        &quot;_id&quot; : &quot;1&quot;,
        &quot;_score&quot; : 1.0,
        &quot;_source&quot; : &#123;
          &quot;name&quot; : &quot;空痕影&quot;,
          &quot;birth&quot; : &quot;2000-12-12&quot;
        &#125;
      &#125;
    ]
  &#125;
&#125;
</code></pre>
</li>
</ol>
</li>
</ol>
<h2 id="Query-String"><a href="#Query-String" class="headerlink" title="Query String"></a>Query String</h2><ul>
<li><p>查询所有</p>
<p>GET user/_search</p>
</li>
<li><p>带参数/精准匹配</p>
<p>GET user/_search?q=name:空痕影</p>
</li>
<li><p>带分页与排序</p>
<p>GET user/_search?from=0&amp;size=2&amp;sort=age:asc</p>
<p>注:带了排序后sort将为null.需要自己开启</p>
</li>
<li><p>_all搜索 相当于在所有<strong>有索引的字段</strong>中检索</p>
<p>GET user/_serach?q=空痕影</p>
</li>
</ul>
<h2 id="全文检索-fulltext-query"><a href="#全文检索-fulltext-query" class="headerlink" title="全文检索 fulltext query"></a>全文检索 fulltext query</h2><ul>
<li><p>match: 匹配包含某个term的子句</p>
<pre><code class="json">GET user/_search
&#123;
  &quot;query&quot;: &#123;
   &quot;match&quot;:&#123;
     &quot;device&quot;: &quot;huawei mate book&quot;
   &#125;
  &#125;
&#125;
结果:
&#123;
  &quot;took&quot; : 1,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : &#123;
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  &#125;,
  &quot;hits&quot; : &#123;
    &quot;total&quot; : &#123;
      &quot;value&quot; : 3,
      &quot;relation&quot; : &quot;eq&quot;
    &#125;,
    &quot;max_score&quot; : 1.1143606,
    &quot;hits&quot; : [
      &#123;
        &quot;_index&quot; : &quot;user&quot;,
        &quot;_type&quot; : &quot;_doc&quot;,
        &quot;_id&quot; : &quot;2&quot;,
        &quot;_score&quot; : 1.1143606,
        &quot;_source&quot; : &#123;
          &quot;name&quot; : &quot;空痕影2&quot;,
          &quot;age&quot; : 15,
          &quot;birth&quot; : &quot;2011-12-12&quot;,
          &quot;sex&quot; : &quot;男&quot;,
          &quot;device&quot; : &quot;huawei mate book&quot;
        &#125;
      &#125;,
      &#123;
        &quot;_index&quot; : &quot;user&quot;,
        &quot;_type&quot; : &quot;_doc&quot;,
        &quot;_id&quot; : &quot;1&quot;,
        &quot;_score&quot; : 0.13353139,
        &quot;_source&quot; : &#123;
          &quot;name&quot; : &quot;空痕影1&quot;,
          &quot;age&quot; : 18,
          &quot;birth&quot; : &quot;2010-12-12&quot;,
          &quot;sex&quot; : &quot;男&quot;,
          &quot;device&quot; : &quot;huawei mate pad&quot;
        &#125;
      &#125;,
      &#123;
        &quot;_index&quot; : &quot;user&quot;,
        &quot;_type&quot; : &quot;_doc&quot;,
        &quot;_id&quot; : &quot;3&quot;,
        &quot;_score&quot; : 0.13353139,
        &quot;_source&quot; : &#123;
          &quot;name&quot; : &quot;空痕影3&quot;,
          &quot;age&quot; : 20,
          &quot;birth&quot; : &quot;1996-12-12&quot;,
          &quot;sex&quot; : &quot;男&quot;,
          &quot;device&quot; : &quot;huawei mate phone&quot;
        &#125;
      &#125;
    ]
  &#125;
&#125;
分析: 英文分词器以空格分隔,将查询词库 分成 huawei,mate,phone 三个词 来查询device字段被分词后的值.
</code></pre>
</li>
<li><p>match_all: 匹配所有结果的子句</p>
<pre><code class="json">GET user/_search
&#123;
  &quot;query&quot;: &#123;
   &quot;match_all&quot;:&#123;&#125;
  &#125;
&#125;
</code></pre>
</li>
<li><p>multi_match: 多字段条件</p>
<pre><code class="json">// 查询数据中 name与desc 字段包含查询字符串&quot;3&quot;的短语的记录.
GET user/_search
&#123;
  &quot;query&quot;: &#123;
    &quot;multi_match&quot;: &#123;
      &quot;query&quot;: &quot;3&quot;,
      &quot;fields&quot;: [&quot;name&quot;,&quot;desc&quot;]
    &#125;
  &#125;
&#125;
结果:
&#123;
  &quot;took&quot; : 0,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : &#123;
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  &#125;,
  &quot;hits&quot; : &#123;
    &quot;total&quot; : &#123;
      &quot;value&quot; : 2,
      &quot;relation&quot; : &quot;eq&quot;
    &#125;,
    &quot;max_score&quot; : 1.3862942,
    &quot;hits&quot; : [
      &#123;
        &quot;_index&quot; : &quot;user&quot;,
        &quot;_type&quot; : &quot;_doc&quot;,
        &quot;_id&quot; : &quot;3&quot;,
        &quot;_score&quot; : 1.3862942,
        &quot;_source&quot; : &#123;
          &quot;name&quot; : &quot;空痕影3&quot;,
          &quot;age&quot; : 20,
          &quot;birth&quot; : &quot;1996-12-12&quot;,
          &quot;sex&quot; : &quot;男&quot;,
          &quot;device&quot; : &quot;huawei mate phone&quot;
        &#125;
      &#125;,
      &#123;
        &quot;_index&quot; : &quot;user&quot;,
        &quot;_type&quot; : &quot;_doc&quot;,
        &quot;_id&quot; : &quot;4&quot;,
        &quot;_score&quot; : 0.6931471,
        &quot;_source&quot; : &#123;
          &quot;name&quot; : &quot;空痕影4&quot;,
          &quot;age&quot; : 20,
          &quot;birth&quot; : &quot;1996-12-12&quot;,
          &quot;sex&quot; : &quot;男&quot;,
          &quot;device&quot; : &quot;huawei mate phone&quot;,
          &quot;desc&quot; : &quot;这是第3条数据&quot;
        &#125;
      &#125;
    ]
  &#125;
&#125;

</code></pre>
</li>
<li><p>match_phrase: 短语查询</p>
<pre><code class="json">// 查询数据中一组词项都匹配的数据.即包含mate与book词项的且

GET user/_search
&#123;
  &quot;query&quot;: &#123;
    &quot;match_phrase&quot;: &#123;
      &quot;device&quot;: &quot;mate book&quot;
    &#125;
  &#125;
&#125;

结果:
&#123;
  &quot;took&quot; : 1,
  &quot;timed_out&quot; : false,
  &quot;_shards&quot; : &#123;
    &quot;total&quot; : 1,
    &quot;successful&quot; : 1,
    &quot;skipped&quot; : 0,
    &quot;failed&quot; : 0
  &#125;,
  &quot;hits&quot; : &#123;
    &quot;total&quot; : &#123;
      &quot;value&quot; : 1,
      &quot;relation&quot; : &quot;eq&quot;
    &#125;,
    &quot;max_score&quot; : 1.3093333,
    &quot;hits&quot; : [
      &#123;
        &quot;_index&quot; : &quot;user&quot;,
        &quot;_type&quot; : &quot;_doc&quot;,
        &quot;_id&quot; : &quot;2&quot;,
        &quot;_score&quot; : 1.3093333,
        &quot;_source&quot; : &#123;
          &quot;name&quot; : &quot;空痕影2&quot;,
          &quot;age&quot; : 15,
          &quot;birth&quot; : &quot;2011-12-12&quot;,
          &quot;sex&quot; : &quot;男&quot;,
          &quot;device&quot; : &quot;huawei mate book&quot;
        &#125;
      &#125;
    ]
  &#125;
&#125;
</code></pre>
</li>
</ul>
<h2 id="精确查找-Term"><a href="#精确查找-Term" class="headerlink" title="精确查找 Term"></a>精确查找 Term</h2><p>team: 匹配和搜索词项完全相等的结果.</p>
<p>term和match_phrase区别:</p>
<ul>
<li>match_phrase 会将检索关键词分词, match_phrase的分词结果必须在被检索字段的分词中都包含，而且顺序必须相同，而且默认必须都是连续的</li>
<li>term搜索不会将搜索词分词,但源文件内的字段分词需要keyword来控制.</li>
</ul>
<p>term和keyword都是不分词.但作用域不同:</p>
<ul>
<li>term是对于搜索词不分词,</li>
<li>keyword是字段类型,是对于source data中的字段值不分词</li>
</ul>
<pre><code class="json">// ik分词器会将NFC手机分为nfc与手机两个词.
// 匹配name字段分词后的词中是否包含&quot;nfc手机&quot;这个完整词的.
GET product/_search
&#123;
  &quot;query&quot;: &#123;
    &quot;term&quot;: &#123;
      &quot;name&quot;: &#123;
        &quot;value&quot;: &quot;nfc手机&quot;
      &#125;
    &#125;
  &#125;
&#125;


// keyword：存储数据时候，不会分词建立索引
// 匹配name字段源数据是否 = &quot;nfc手机&quot; 这个词
GET product/_search
&#123;
  &quot;query&quot;: &#123;
    &quot;term&quot;: &#123;
      &quot;name.keyword&quot;: &#123;
        &quot;value&quot;: &quot;nfc手机&quot;
      &#125;
    &#125;
  &#125;
&#125;
</code></pre>
<p>teams: 匹配和搜索词项列表中任意项匹配的结果</p>
<pre><code class="json">// 查询 product 中的name字段是否包含小米与nfc词项.
GET product/_search
&#123;
  &quot;query&quot;: &#123;
    &quot;terms&quot;: &#123;
      &quot;name&quot;: [
        &quot;小米&quot;,
        &quot;nfc&quot;
      ]
    &#125;
  &#125;
&#125;
</code></pre>
<p>range：范围查找</p>
<pre><code class="json">// 查询价格大于1K,小于3K的记录
GET product/_search
&#123;
  &quot;query&quot;: &#123;
    &quot;range&quot;: &#123;
      &quot;price&quot;: &#123;
        &quot;gte&quot;: 1000,
        &quot;lte&quot;: 3000
      &#125;
    &#125;
  &#125;
&#125;    
</code></pre>
<h2 id="过滤器-Filter"><a href="#过滤器-Filter" class="headerlink" title="过滤器 Filter"></a>过滤器 Filter</h2><p>query和filter的主要区别在： </p>
<ul>
<li>filter是结果导向的而query是过程导向。</li>
<li>query倾向于“当前文档和查询的语句的相关度”而filter倾向于“当前文档和查询的条件是不是相符”。即在查询过程中，query是要对查询的每个结果计算相关性得分的，而filter不会。</li>
<li>另外filter有相应的缓存机制，可以提高查询效率。</li>
</ul>
<h2 id="组合查询-Bool-query"><a href="#组合查询-Bool-query" class="headerlink" title="组合查询-Bool query"></a>组合查询-Bool query</h2><p>可以组合多个查询条件，bool查询也是采用more_matches_is_better的机制，因此满足must和should子句的文档将会合并起来计算分值</p>
<pre><code class="json">// 格式:
&#123;
   &quot;bool&quot; : &#123;
      &quot;must&quot; :     [],
      &quot;should&quot; :   [],
      &quot;filter&quot; : [],
      &quot;must_not&quot; : [],
   &#125;
&#125;
</code></pre>
<ul>
<li><strong>must</strong>：必须满足子句（查询）必须出现在匹配的文档中，并将有助于得分。</li>
<li><strong>filter</strong>：过滤器 不计算相关度分数，cache子句（查询）必须出现在匹配的文档中。但是不像 must查询的分数将被忽略。Filter子句在<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-filter-context.html">filter上下文</a>中执行，这意味着计分被忽略，并且子句被考虑用于缓存。</li>
<li><strong>should</strong>：可能满足 or子句（查询）应出现在匹配的文档中。</li>
<li><strong>must_not</strong>：必须不满足 不计算相关度分数 not子句（查询）不得出现在匹配的文档中。子句在<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-filter-context.html">过滤器上下文</a>中执行，这意味着计分被忽略，并且子句被视为用于缓存。由于忽略计分，0因此将返回所有文档的分数。</li>
</ul>
<p><strong>minimum_should_match</strong>：参数指定should返回的文档必须匹配的子句的数量或百分比。如果bool查询包含至少一个should子句，而没有must或 filter子句，则默认值为1。否则，默认值为0</p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls"
                data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
            <ul id="audio-list" style="display:none">
                
                
                <li title='0' data-url='/statics/折戸伸治 - 梦のあと I.mp3'></li>
                
                    
            </ul>
            
            
            
        </div>
        <div class="sidebar">
            <div class="box animated fadeInRight">
                <div class="subbox">
                    <img src="/img/avatar.jpg" height=300 width=300></img>
                    <p>空痕影</p>
                    <span>学而不思则罔,思而不学则殆.</span>
                    <dl>
                        <dd><a href="https://github.com/konghenying" target="_blank"><span
                                    class=" iconfont icon-github"></span></a></dd>
                        <dd><a href="" target="_blank"><span
                                    class=" iconfont icon-twitter"></span></a></dd>
                        <dd><a href="" target="_blank"><span
                                    class=" iconfont icon-stack-overflow"></span></a></dd>
                    </dl>
                </div>
                <ul>
                    <li><a href="/">92 <p>文章</p></a></li>
                    <li><a href="/categories">18 <p>分类</p></a></li>
                    <li><a href="/tags">18 <p>标签</p></a></li>
                </ul>
            </div>
            
            
            
            <div class="box sticky animated fadeInRight faster">
                <div id="toc" class="subbox">
                    <h4>目录</h4>
                    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E4%B8%8E%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.</span> <span class="toc-text">搜索与查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="toc-number">1.1.</span> <span class="toc-text">查询上下文</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.1.1.</span> <span class="toc-text">查询示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.2.</span> <span class="toc-text">结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%BA%A6%E8%AF%84%E5%88%86"><span class="toc-number">1.2.</span> <span class="toc-text">相关度评分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">1.3.</span> <span class="toc-text">元数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Query-String"><span class="toc-number">1.4.</span> <span class="toc-text">Query String</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2-fulltext-query"><span class="toc-number">1.5.</span> <span class="toc-text">全文检索 fulltext query</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B2%BE%E7%A1%AE%E6%9F%A5%E6%89%BE-Term"><span class="toc-number">1.6.</span> <span class="toc-text">精确查找 Term</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8-Filter"><span class="toc-number">1.7.</span> <span class="toc-text">过滤器 Filter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E6%9F%A5%E8%AF%A2-Bool-query"><span class="toc-number">1.8.</span> <span class="toc-text">组合查询-Bool query</span></a></li></ol></li></ol>
                </div>
            </div>
            
            
        </div>
    </div>
</div>

    </div>
</div>
    <div id="back-to-top" class="animated fadeIn faster">
        <div class="flow"></div>
        <span class="percentage animated fadeIn faster">0%</span>
        <span class="iconfont icon-top02 animated fadeIn faster"></span>
    </div>
</body>
<footer>
    <p class="copyright" id="copyright">
        &copy; 2025
        <span class="gradient-text">
            空痕影
        </span>.
        Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a>
        Theme
        <span class="gradient-text">
            <a href="https://github.com/TriDiamond/hexo-theme-obsidian" title="Obsidian" target="_blank" rel="noopener">Obsidian</a>
        </span>
        <small><a href="https://github.com/TriDiamond/hexo-theme-obsidian/blob/master/CHANGELOG.md" title="v1.4.4" target="_blank" rel="noopener">v1.4.4</a></small>
    </p>
</footer>

<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script>
  MathJax.Hub.Config({
    "HTML-CSS": {
      preferredFont: "TeX",
      availableFonts: ["STIX", "TeX"],
      linebreaks: {
        automatic: true
      },
      EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
      inlineMath: [
        ["$", "$"],
        ["\\(", "\\)"]
      ],
      processEscapes: true,
      ignoreClass: "tex2jax_ignore|dno",
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      noUndefined: {
        attributes: {
          mathcolor: "red",
          mathbackground: "#FFEEEE",
          mathsize: "90%"
        }
      },
      Macros: {
        href: "{}"
      }
    },
    messageStyle: "none"
  });
</script>
<script>
  function initialMathJax() {
    MathJax.Hub.Queue(function () {
      var all = MathJax.Hub.getAllJax(),
        i;
      // console.log(all);
      for (i = 0; i < all.length; i += 1) {
        console.log(all[i].SourceElement().parentNode)
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  }

  function reprocessMathJax() {
    if (typeof MathJax !== 'undefined') {
      MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
    }
  }
</script>


 
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/obsidian.js"></script>
<script src="/js/jquery.truncate.js"></script>
<script src="/js/search.js"></script>
 
<script src="//cdn.bootcss.com/typed.js/2.0.10/typed.min.js"></script>
 
<script src="//cdn.bootcss.com/blueimp-md5/2.12.0/js/md5.min.js"></script>
 
<script src="//cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>


<script src="https://cdn.bootcss.com/codemirror/5.48.4/codemirror.min.js"></script>
 
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/javascript/javascript.min.js"></script>
  
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/css/css.min.js"></script>
  
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/xml/xml.min.js"></script>
  
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/htmlmixed/htmlmixed.min.js"></script>
  
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/clike/clike.min.js"></script>
  
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/php/php.min.js"></script>
  
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/shell/shell.min.js"></script>
  
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/python/python.min.js"></script>
   
<script src="/js/busuanzi.min.js"></script>

<script>
  $(document).ready(function () {
    if ($('span[id^="busuanzi_"]').length) {
      initialBusuanzi();
    }
  });
</script>
 
<link rel="stylesheet" href="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="//cdn.bootcss.com/photoswipe/4.1.3/default-skin/default-skin.min.css">


<script src="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>
 
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="//www.googletagmanager.com/gtag/js?id=UA-149874671-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag('js', new Date());

  gtag('config', 'UA-149874671-1');
</script>
 

<script>
  function initialTyped() {
    var typedTextEl = $('.typed-text');
    if (typedTextEl && typedTextEl.length > 0) {
      var typed = new Typed('.typed-text', {
        strings: ['学而不思则罔,思而不学则殆.', '岁月是一指流沙,苍老是一段年华.'],
        typeSpeed: 90,
        loop: true,
        loopCount: Infinity,
        backSpeed: 20,
      });
    }
  }

  if ($('.article-header') && $('.article-header').length) {
    $(document).ready(function () {
      initialTyped();
    });
  }
</script>




 <!-- 例：百度统计 --> <script> var _hmt = _hmt || []; (function() { var hm = document.createElement("script"); hm.src = "https://hm.baidu.com/hm.js?d180eba02c599a67bfa54b22bf3b32f2"; var s = document.getElementsByTagName("script")[0];  s.parentNode.insertBefore(hm, s); })(); </script> 

</html>
